<!DOCTYPE html>
<head>
	<meta charset="utf-8">
	<title>Speed Dating</title>

    <script src="library/d3/d3.min.js" charset="utf-8"></script>
    <script src="library/jquery/jquery-2.1.1.min.js" charset="utf-8"></script>
    <script src="library/bootstrap/js/bootstrap.min.js" charset="utf-8"></script>
    <script src="library/queue/queue.min.js" charset="utf-8"></script>

	<style>
	</style>
</head>
<body>

<script>
	// call this function after both files are loaded -- error should be "null" if no error
	var dataLoaded = function (error, datingdata) {

	    if (!error) {

	    	// aggregate by wave
			data = d3.nest()
				.key(function(d) { return d.wave;})
				.rollup(function(d) { 
					return d;
				})
				.entries(datingdata);

			var datalength = data.length;
			
			// aggregate by person
			for (var i =0; i < datalength; i++) {
				var data_row = d3.nest()
					.key(function(d) { return d.iid;})
					.rollup(function(d) {
						return d;
					})
					.entries(data[i]["values"]);
				data[i] = data_row;

				var datailength = data[i].length

				//  organize by person
				for (var j=0;j<datailength;j++) {
					data[i][j].gender = data[i][j]['values'][0]['gender'];
					data[i][j].race = 
					data[i][j].age =
					data[i][j].startpref =
					data[i][j].halfpref =
					data[i][j].daypref = 
					data[i][j].weekpref =
					data[i][j].goal =
					data[i][j].career =
					data[i][j].partners =
				}
			}


		console.log(data)
	    }
	}

	var startHere = function(){

	    //TODO: load data here and call "dataLoaded" afterwards
	    queue() // loads all the data files
	        .defer(d3.csv, '/data/SpeedDating.csv') // metadata
	        .await(dataLoaded); // function that uses files


	}

	startHere();

</script>
</body>
</html>